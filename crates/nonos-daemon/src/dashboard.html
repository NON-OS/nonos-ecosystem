<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NONOS Node Dashboard</title>
    <style>
        :root {
            --bg-primary: #0d0d1a;
            --bg-secondary: #14142b;
            --bg-tertiary: #1a1a3a;
            --text-primary: #f0f0ff;
            --text-secondary: #a0a0c0;
            --text-muted: #606080;
            --accent-primary: #00d4ff;
            --accent-secondary: #0099cc;
            --border: #2a2a4a;
            --success: #00ff88;
            --warning: #ffaa00;
            --error: #ff4444;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
        }
        .header {
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border);
            padding: 16px 24px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        .logo svg { width: 40px; height: 40px; }
        .logo h1 {
            font-size: 20px;
            font-weight: 600;
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .status-badge {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            background: var(--bg-tertiary);
            border-radius: 20px;
            font-size: 14px;
        }
        .status-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }
        .status-running { background: var(--success); }
        .status-stopped { background: var(--error); }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 24px;
        }
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 24px;
        }
        .card {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 20px;
        }
        .card-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 16px;
        }
        .card-title {
            font-size: 14px;
            font-weight: 500;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        .metric {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }
        .metric-value {
            font-size: 32px;
            font-weight: 700;
            color: var(--accent-primary);
        }
        .metric-label {
            font-size: 13px;
            color: var(--text-muted);
        }
        .quality-bar {
            height: 8px;
            background: var(--bg-tertiary);
            border-radius: 4px;
            overflow: hidden;
            margin-top: 8px;
        }
        .quality-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--accent-primary), var(--success));
            border-radius: 4px;
            transition: width 0.3s ease;
        }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 16px;
        }
        .stat-item {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }
        .stat-value {
            font-size: 24px;
            font-weight: 600;
        }
        .stat-label {
            font-size: 12px;
            color: var(--text-muted);
        }
        .table {
            width: 100%;
            border-collapse: collapse;
        }
        .table th, .table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid var(--border);
        }
        .table th {
            font-size: 12px;
            font-weight: 500;
            color: var(--text-muted);
            text-transform: uppercase;
        }
        .check-pass { color: var(--success); }
        .check-warn { color: var(--warning); }
        .check-fail { color: var(--error); }
        .refresh-btn {
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            color: var(--text-primary);
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s;
        }
        .refresh-btn:hover {
            border-color: var(--accent-primary);
            background: rgba(0, 212, 255, 0.1);
        }
        .tier-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
        }
        .tier-Community { background: rgba(0, 212, 255, 0.2); color: var(--accent-primary); }
        .tier-Professional { background: rgba(0, 255, 136, 0.2); color: var(--success); }
        .tier-Enterprise { background: rgba(255, 170, 0, 0.2); color: var(--warning); }
        .peer-list {
            max-height: 200px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 12px;
            color: var(--text-secondary);
        }
        .peer-item {
            padding: 8px;
            border-bottom: 1px solid var(--border);
        }
        .peer-item:last-child { border-bottom: none; }
        .actions {
            display: flex;
            gap: 12px;
            margin-top: 16px;
        }
        .btn {
            padding: 10px 20px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            border: none;
            transition: all 0.2s;
        }
        .btn-primary {
            background: var(--accent-primary);
            color: var(--bg-primary);
        }
        .btn-primary:hover { background: var(--accent-secondary); }
        .btn-secondary {
            background: var(--bg-tertiary);
            color: var(--text-primary);
            border: 1px solid var(--border);
        }
        .btn-secondary:hover { border-color: var(--accent-primary); }
        .loading {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 40px;
            color: var(--text-muted);
        }
        .spinner {
            width: 24px;
            height: 24px;
            border: 2px solid var(--border);
            border-top-color: var(--accent-primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 12px;
        }
        @keyframes spin { to { transform: rotate(360deg); } }
        .footer {
            text-align: center;
            padding: 24px;
            color: var(--text-muted);
            font-size: 12px;
            border-top: 1px solid var(--border);
            margin-top: 40px;
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="logo">
            <svg viewBox="0 0 64 64" fill="none">
                <rect width="64" height="64" rx="12" fill="url(#grad)"/>
                <path d="M32 12L52 32L32 52L12 32L32 12Z" fill="#0d0d1a"/>
                <path d="M32 20L44 32L32 44L20 32L32 20Z" fill="url(#grad)"/>
                <defs>
                    <linearGradient id="grad" x1="0" y1="0" x2="64" y2="64">
                        <stop offset="0%" stop-color="#00d4ff"/>
                        <stop offset="100%" stop-color="#0099cc"/>
                    </linearGradient>
                </defs>
            </svg>
            <h1>NONOS Node</h1>
        </div>
        <div class="status-badge">
            <div class="status-dot" id="statusDot"></div>
            <span id="statusText">Connecting...</span>
        </div>
    </header>

    <div class="container">
        <div class="grid">
            <div class="card">
                <div class="card-header">
                    <span class="card-title">Node Status</span>
                    <button class="refresh-btn" onclick="refresh()">Refresh</button>
                </div>
                <div class="metric">
                    <span class="metric-value" id="nodeId">---</span>
                    <span class="metric-label">Node ID</span>
                </div>
                <div style="margin-top: 16px;">
                    <span class="tier-badge" id="tierBadge">---</span>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <span class="card-title">Quality Score</span>
                </div>
                <div class="metric">
                    <span class="metric-value" id="qualityScore">---%</span>
                    <span class="metric-label">Overall Performance</span>
                </div>
                <div class="quality-bar">
                    <div class="quality-fill" id="qualityBar" style="width: 0%"></div>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <span class="card-title">Uptime</span>
                </div>
                <div class="metric">
                    <span class="metric-value" id="uptime">0:00:00</span>
                    <span class="metric-label">Since Start</span>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <span class="card-title">Rewards</span>
                </div>
                <div class="stats-grid">
                    <div class="stat-item">
                        <span class="stat-value" id="stakedNox">0</span>
                        <span class="stat-label">Staked NOX</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-value" id="pendingRewards">0</span>
                        <span class="stat-label">Pending Rewards</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-value" id="streak">0</span>
                        <span class="stat-label">Day Streak</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-value" id="connections">0</span>
                        <span class="stat-label">Connections</span>
                    </div>
                </div>
            </div>
        </div>

        <div class="grid">
            <div class="card">
                <div class="card-header">
                    <span class="card-title">Request Statistics</span>
                </div>
                <div class="stats-grid">
                    <div class="stat-item">
                        <span class="stat-value" id="totalRequests">0</span>
                        <span class="stat-label">Total Requests</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-value" id="successfulRequests">0</span>
                        <span class="stat-label">Successful</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-value" id="successRate">0%</span>
                        <span class="stat-label">Success Rate</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-value" id="failedRequests">0</span>
                        <span class="stat-label">Failed</span>
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <span class="card-title">Quality Metrics</span>
                </div>
                <div class="stats-grid">
                    <div class="stat-item">
                        <span class="stat-value" id="uptimeScore">0%</span>
                        <span class="stat-label">Uptime</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-value" id="latencyScore">0%</span>
                        <span class="stat-label">Latency</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-value" id="reliabilityScore">0%</span>
                        <span class="stat-label">Reliability</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-value" id="peerCount">0</span>
                        <span class="stat-label">Peers</span>
                    </div>
                </div>
            </div>
        </div>

        <div class="grid">
            <div class="card">
                <div class="card-header">
                    <span class="card-title">Diagnostics</span>
                </div>
                <table class="table" id="diagnosticsTable">
                    <thead>
                        <tr>
                            <th>Check</th>
                            <th>Status</th>
                            <th>Message</th>
                        </tr>
                    </thead>
                    <tbody id="diagnosticsBody">
                        <tr><td colspan="3" class="loading"><div class="spinner"></div>Loading...</td></tr>
                    </tbody>
                </table>
            </div>

            <div class="card">
                <div class="card-header">
                    <span class="card-title">Connected Peers</span>
                </div>
                <div class="peer-list" id="peerList">
                    <div class="loading"><div class="spinner"></div>Loading...</div>
                </div>
            </div>
        </div>

        <div class="card">
            <div class="card-header">
                <span class="card-title">Actions</span>
            </div>
            <div class="actions">
                <button class="btn btn-primary" onclick="rotateIdentity()">Rotate Identity</button>
                <button class="btn btn-secondary" onclick="exportMetrics()">Export Prometheus Metrics</button>
                <button class="btn btn-secondary" onclick="downloadLogs()">Download Logs</button>
            </div>
        </div>
    </div>

    <footer class="footer">
        NONOS Node v1.0.0 | Powered by Anyone Network | <a href="https://nonos.systems" style="color: var(--accent-primary);">nonos.systems</a>
    </footer>

    <script>
        const API_BASE = window.location.origin;
        let refreshInterval;

        async function fetchStatus() {
            try {
                const res = await fetch(`${API_BASE}/api/status`);
                const data = await res.json();

                document.getElementById('statusDot').className = `status-dot status-${data.status.toLowerCase()}`;
                document.getElementById('statusText').textContent = data.status;
                document.getElementById('nodeId').textContent = data.node_id.substring(0, 16) + '...';
                document.getElementById('tierBadge').textContent = data.tier;
                document.getElementById('tierBadge').className = `tier-badge tier-${data.tier}`;
                document.getElementById('qualityScore').textContent = (data.quality_score * 100).toFixed(1) + '%';
                document.getElementById('qualityBar').style.width = (data.quality_score * 100) + '%';
                document.getElementById('uptime').textContent = formatUptime(data.uptime_secs);
                document.getElementById('stakedNox').textContent = data.staked_nox.toFixed(2);
                document.getElementById('pendingRewards').textContent = data.pending_rewards.toFixed(4);
                document.getElementById('streak').textContent = data.streak_days;
                document.getElementById('connections').textContent = data.active_connections;
                document.getElementById('totalRequests').textContent = data.total_requests.toLocaleString();
                document.getElementById('successfulRequests').textContent = data.successful_requests.toLocaleString();

                const failed = data.total_requests - data.successful_requests;
                document.getElementById('failedRequests').textContent = failed.toLocaleString();

                const rate = data.total_requests > 0 ? (data.successful_requests / data.total_requests * 100) : 100;
                document.getElementById('successRate').textContent = rate.toFixed(1) + '%';
            } catch (e) {
                console.error('Failed to fetch status:', e);
                document.getElementById('statusDot').className = 'status-dot status-stopped';
                document.getElementById('statusText').textContent = 'Disconnected';
            }
        }

        async function fetchMetrics() {
            try {
                const res = await fetch(`${API_BASE}/api/metrics`);
                const data = await res.json();

                document.getElementById('uptimeScore').textContent = (data.quality.uptime * 100).toFixed(1) + '%';
                document.getElementById('latencyScore').textContent = (data.quality.latency_score * 100).toFixed(1) + '%';
                document.getElementById('reliabilityScore').textContent = (data.quality.reliability * 100).toFixed(1) + '%';
                document.getElementById('peerCount').textContent = data.network.peer_count;
            } catch (e) {
                console.error('Failed to fetch metrics:', e);
            }
        }

        async function fetchDiagnostics() {
            try {
                const res = await fetch(`${API_BASE}/api/diagnostics`);
                const data = await res.json();

                const tbody = document.getElementById('diagnosticsBody');
                tbody.innerHTML = data.checks.map(check => `
                    <tr>
                        <td>${check.name}</td>
                        <td class="check-${check.status}">${check.status.toUpperCase()}</td>
                        <td>${check.message}</td>
                    </tr>
                `).join('');
            } catch (e) {
                console.error('Failed to fetch diagnostics:', e);
            }
        }

        async function fetchPeers() {
            try {
                const res = await fetch(`${API_BASE}/api/peers`);
                const data = await res.json();

                const list = document.getElementById('peerList');
                if (data.peers.length === 0) {
                    list.innerHTML = '<div class="peer-item" style="color: var(--text-muted);">No peers connected</div>';
                } else {
                    list.innerHTML = data.peers.map(peer => `
                        <div class="peer-item">${peer}</div>
                    `).join('');
                }
            } catch (e) {
                console.error('Failed to fetch peers:', e);
            }
        }

        function formatUptime(secs) {
            const h = Math.floor(secs / 3600);
            const m = Math.floor((secs % 3600) / 60);
            const s = secs % 60;
            return `${h}:${String(m).padStart(2, '0')}:${String(s).padStart(2, '0')}`;
        }

        async function refresh() {
            await Promise.all([
                fetchStatus(),
                fetchMetrics(),
                fetchDiagnostics(),
                fetchPeers()
            ]);
        }

        async function rotateIdentity() {
            try {
                const res = await fetch(`${API_BASE}/api/identity/rotate`, { method: 'POST' });
                const data = await res.json();
                alert(data.message);
            } catch (e) {
                alert('Failed to rotate identity');
            }
        }

        async function exportMetrics() {
            window.open(`${API_BASE}/api/metrics/prometheus`, '_blank');
        }

        function downloadLogs() {
            alert('Log download not yet implemented');
        }

        // Initial load
        refresh();

        // Auto-refresh every 5 seconds
        refreshInterval = setInterval(refresh, 5000);
    </script>
</body>
</html>
